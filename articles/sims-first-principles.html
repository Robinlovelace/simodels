<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>An introduction to spatial interaction models: from first principles • simodels</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An introduction to spatial interaction models: from first principles">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">simodels</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/simodels.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/sims-first-principles.html">An introduction to spatial interaction models: from first principles</a></li>
    <li><a class="dropdown-item" href="../articles/validation.html">Validation of spatial interaction models</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/robinlovelace/simodels/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>An introduction to spatial interaction models: from first principles</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/robinlovelace/simodels/blob/main/vignettes/sims-first-principles.Rmd" class="external-link"><code>vignettes/sims-first-principles.Rmd</code></a></small>
      <div class="d-none name"><code>sims-first-principles.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="what-are-sims">What are SIMs?<a class="anchor" aria-label="anchor" href="#what-are-sims"></a>
</h2>
<p>Spatial Interaction Models (SIMs) are mathematical models for
estimating movement between spatial entities developed by Alan Wilson in
the late 1960s and early 1970, with considerable uptake and refinement
for transport modelling since then <span class="citation">Boyce and
Williams (2015)</span>. There are four main types of traditional SIMs
<span class="citation">(Wilson 1971)</span>:</p>
<ul>
<li><p>Unconstrained</p></li>
<li><p>Production-constrained</p></li>
<li><p>Attraction-constrained</p></li>
<li><p>Doubly-constrained</p></li>
</ul>
<p>An early and highly influential type of SIM was the ‘gravity model’,
defined by <span class="citation">Wilson (1971)</span> as follows (in a
paper that explored many iterations on this formulation):</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>K</mi><mfrac><mrow><msubsup><mi>W</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><msubsup><mi>W</mi><mi>j</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup></mrow><msubsup><mi>c</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>n</mi></msubsup></mfrac></mrow><annotation encoding="application/x-tex">
T_{i j}=K \frac{W_{i}^{(1)} W_{j}^{(2)}}{c_{i j}^{n}}
</annotation></semantics></math></p>
<p>“where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">T_{i j}</annotation></semantics></math>
is a measure of the interaction between zones
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>W</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">W_{i}^{(1)}</annotation></semantics></math>
is a measure of the ‘mass term’ associated with zone
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mi>i</mi></msub><annotation encoding="application/x-tex">z_i</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>W</mi><mi>j</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">W_{j}^{(2)}</annotation></semantics></math>
is a measure of the ‘mass term’ associated with zone
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mi>j</mi></msub><annotation encoding="application/x-tex">z_j</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">c_{ij}</annotation></semantics></math>
is a measure of the distance, or generalised cost of travel, between
zone
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and zone
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>”.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
is a ‘constant of proportionality’ and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
is a parameter to be estimated.</p>
<p>Redefining the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
terms as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
for origins and destinations respectively <span class="citation">(Simini
et al. 2012)</span>, this classic definition of the ‘gravity model’ can
be written as follows:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>K</mi><mfrac><mrow><msub><mi>m</mi><mi>i</mi></msub><msub><mi>n</mi><mi>j</mi></msub></mrow><msubsup><mi>c</mi><mrow><mi>i</mi><mi>j</mi></mrow><mi>n</mi></msubsup></mfrac></mrow><annotation encoding="application/x-tex">
T_{i j}=K \frac{m_{i} n_{j}}{c_{i j}^{n}}
</annotation></semantics></math></p>
<p>For the purposes of this project, we will focus on
production-constrained SIMs. These can be defined as follows <span class="citation">(Wilson 1971)</span>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>A</mi><mi>i</mi></msub><msub><mi>O</mi><mi>i</mi></msub><msub><mi>n</mi><mi>j</mi></msub><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>c</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
T_{ij} = A_iO_in_jf(c_{ij})
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
is a balancing factor defined as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mfrac><mn>1</mn><mrow><munder><mo>∑</mo><mi>j</mi></munder><msub><mi>m</mi><mi>j</mi></msub><mi mathvariant="normal">f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>c</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">
A_{i}=\frac{1}{\sum_{j} m_{j} \mathrm{f}\left(c_{i j}\right)}
</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>O</mi><mi>i</mi></msub><annotation encoding="application/x-tex">O_i</annotation></semantics></math>
is analogous to the travel demand in zone
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
which can be roughly approximated by its population.</p>
<p>More recent innovations in SIMs including the ‘radiation model’ <span class="citation">Simini et al. (2012)</span>. See <span class="citation">Lenormand, Bassolas, and Ramasco (2016)</span> for a
comparison of alternative approaches.</p>
<!-- ## Radiation models -->
<!-- A more recent type of SIM is the radiation model @simini_universal_2012: -->
<!-- $$ -->
<!-- \langle T_{ij} \rangle = T_i \frac{m_{i} n_{j}} {(m_i + s_{ij})(m_i + n_j + s_{ij}) } -->
<!-- $$ -->
<!-- where $s_{ij}$ is defined as the total population living within a circle, the centre of which lies in the centroid of zone $i$ and the radius of which is the distance between zones $i$ and $j$. Thus, the greater the population living within the commute distance, the lower the estimated flow rate. -->
</div>
<div class="section level2">
<h2 id="implementation-in-r">Implementation in R<a class="anchor" aria-label="anchor" href="#implementation-in-r"></a>
</h2>
<p>Before using the functions in this or other packages, it may be worth
implementing SIMs from first principles, to gain an understanding of how
they work. The code presented below was written before the functions in
the <code>simodels</code> package were developed, building on <span class="citation">Dennett (2018)</span>. The aim is to demonstrate a
common way of running SIMs, in a for loop, rather than using vectorised
operations (used in the <code>simodels</code> package) which can be
faster.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap" class="external-link">tmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zones</span> <span class="op">=</span> <span class="fu">simodels</span><span class="fu">::</span><span class="va"><a href="../reference/si_zones.html">si_zones</a></span></span>
<span><span class="va">centroids</span> <span class="op">=</span> <span class="fu">simodels</span><span class="fu">::</span><span class="va"><a href="../reference/si_zones.html">si_centroids</a></span></span>
<span><span class="va">od</span> <span class="op">=</span> <span class="fu">simodels</span><span class="fu">::</span><span class="va"><a href="../reference/si_od_census.html">si_od_census</a></span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">zones</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span><span class="st">"all"</span>, palette <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">tmap v3 code detected</span> <span style="color: #00BBBB;">───────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">[v3-&gt;v4]</span> `tm_tm_polygons()`: migrate the argument(s) related to the scale of</span></span>
<span><span class="co">#&gt; the visual variable `fill` namely 'palette' (rename to 'values') to fill.scale</span></span>
<span><span class="co">#&gt; = tm_scale(&lt;HERE&gt;).</span></span></code></pre></div>
<p><img src="sims-first-principles_files/figure-html/inputs-1.png" width="700"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od_df</span> <span class="op">=</span> <span class="fu">od</span><span class="fu">::</span><span class="fu"><a href="https://itsleeds.github.io/od/reference/points_to_od.html" class="external-link">points_to_od</a></span><span class="op">(</span><span class="va">centroids</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">=</span> <span class="fu">od</span><span class="fu">::</span><span class="va"><a href="https://itsleeds.github.io/od/reference/od_data_centroids.html" class="external-link">od_data_centroids</a></span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span></span>
<span><span class="fu">od</span><span class="fu">::</span><span class="fu"><a href="https://itsleeds.github.io/od/reference/points_to_od.html" class="external-link">points_to_od</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt;             O         D        ox       oy        dx       dy</span></span>
<span><span class="co">#&gt; 1   E02002407 E02002407 -1.609934 53.79079 -1.609934 53.79079</span></span>
<span><span class="co">#&gt; 1.1 E02002407 E02002336 -1.609934 53.79079 -1.624630 53.88605</span></span>
<span><span class="co">#&gt; 1.2 E02002407 E02002353 -1.609934 53.79079 -1.518058 53.84066</span></span>
<span><span class="co">#&gt; 2   E02002336 E02002407 -1.624630 53.88605 -1.609934 53.79079</span></span>
<span><span class="co">#&gt; 2.1 E02002336 E02002336 -1.624630 53.88605 -1.624630 53.88605</span></span>
<span><span class="co">#&gt; 2.2 E02002336 E02002353 -1.624630 53.88605 -1.518058 53.84066</span></span>
<span><span class="co">#&gt; 3   E02002353 E02002407 -1.518058 53.84066 -1.609934 53.79079</span></span>
<span><span class="co">#&gt; 3.1 E02002353 E02002336 -1.518058 53.84066 -1.624630 53.88605</span></span>
<span><span class="co">#&gt; 3.2 E02002353 E02002353 -1.518058 53.84066 -1.518058 53.84066</span></span>
<span></span>
<span><span class="va">od_sfc</span> <span class="op">=</span> <span class="fu">od</span><span class="fu">::</span><span class="fu"><a href="https://itsleeds.github.io/od/reference/odc_to_sfc.html" class="external-link">odc_to_sfc</a></span><span class="op">(</span><span class="va">od_df</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">od_sfc</span><span class="op">)</span> <span class="op">=</span> <span class="fl">4326</span></span>
<span><span class="va">od_df</span><span class="op">$</span><span class="va">length</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_length</a></span><span class="op">(</span><span class="va">od_sfc</span><span class="op">)</span></span>
<span><span class="va">od_df</span> <span class="op">=</span> <span class="va">od_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span></span>
<span>    <span class="va">O</span>, <span class="va">D</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">length</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1000</span>,</span>
<span>    flow <span class="op">=</span> <span class="cn">NA</span>, fc <span class="op">=</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">od_df</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="va">od_df</span>, geometry <span class="op">=</span> <span class="va">od_sfc</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span></code></pre></div>
<p>An unconstrained spatial interaction model can be written as follows,
with a more-or-less arbitrary value for <code>beta</code> which can be
optimised later:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">=</span> <span class="fl">0.3</span></span>
<span><span class="va">i</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">j</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">zones</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">zones</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">O</span> <span class="op">=</span> <span class="va">zones</span><span class="op">$</span><span class="va">all</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">n</span> <span class="op">=</span> <span class="va">zones</span><span class="op">$</span><span class="va">all</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>    <span class="va">ij</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">od_df</span><span class="op">$</span><span class="va">O</span> <span class="op">==</span> <span class="va">zones</span><span class="op">$</span><span class="va">geo_code</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">od_df</span><span class="op">$</span><span class="va">D</span> <span class="op">==</span> <span class="va">zones</span><span class="op">$</span><span class="va">geo_code</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">od_df</span><span class="op">$</span><span class="va">fc</span><span class="op">[</span><span class="va">ij</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">beta</span> <span class="op">*</span> <span class="va">od_df</span><span class="op">$</span><span class="va">length</span><span class="op">[</span><span class="va">ij</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">od_df</span><span class="op">$</span><span class="va">flow</span><span class="op">[</span><span class="va">ij</span><span class="op">]</span> <span class="op">=</span> <span class="va">O</span> <span class="op">*</span> <span class="va">n</span> <span class="op">*</span> <span class="va">od_df</span><span class="op">$</span><span class="va">fc</span><span class="op">[</span><span class="va">ij</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">od_top</span> <span class="op">=</span> <span class="va">od_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">O</span> <span class="op">!=</span> <span class="va">D</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html" class="external-link">top_n</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2000</span>, wt <span class="op">=</span> <span class="va">flow</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">zones</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">od_top</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="st">"flow"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sims-first-principles_files/figure-html/unconstrained-1.png" width="700"></p>
<p>We can plot the ‘distance decay’ curve associated with this SIM is as
follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">od_df</span><span class="op">$</span><span class="va">fc</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span><span class="co">#&gt; 0.0002404 0.0256166 0.0801970 0.1495649 0.2035826 1.0000000</span></span>
<span><span class="va">od_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">length</span>, <span class="va">fc</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="sims-first-principles_files/figure-html/distance_decay-1.png" width="700"></p>
<p>We can make this production constrained as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od_dfj</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>  <span class="va">od_df</span>,</span>
<span>  <span class="va">zones</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>O <span class="op">=</span> <span class="va">geo_code</span>, <span class="va">all</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(O)`</span></span>
<span><span class="va">od_dfj</span> <span class="op">=</span> <span class="va">od_dfj</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">O</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>flow_constrained <span class="op">=</span> <span class="va">flow</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">flow</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">all</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">od_dfj</span><span class="op">$</span><span class="va">flow_constrained</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">zones</span><span class="op">$</span><span class="va">all</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="va">od_top</span> <span class="op">=</span> <span class="va">od_dfj</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">O</span> <span class="op">!=</span> <span class="va">D</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html" class="external-link">top_n</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2000</span>, wt <span class="op">=</span> <span class="va">flow_constrained</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">zones</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">od_top</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_lines.html" class="external-link">tm_lines</a></span><span class="op">(</span><span class="st">"flow_constrained"</span><span class="op">)</span></span></code></pre></div>
<p><img src="sims-first-principles_files/figure-html/constrained-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="validation">Validation<a class="anchor" aria-label="anchor" href="#validation"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">od_dfjc</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">od_dfj</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">all</span><span class="op">)</span>, <span class="va">od</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(O, D)`</span></span>
<span><span class="va">od_dfjc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">all</span>, <span class="va">flow_constrained</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="sims-first-principles_files/figure-html/validation-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">od_dfjc</span><span class="op">$</span><span class="va">all</span>, <span class="va">od_dfjc</span><span class="op">$</span><span class="va">flow_constrained</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="co">#&gt; [1] 0.1735933</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-boyce_forecasting_2015" class="csl-entry">
Boyce, David E., and Huw C. W. L. Williams. 2015. <em>Forecasting Urban
Travel: Past, Present and Future</em>. Edward Elgar Publishing.
</div>
<div id="ref-dennett_modelling_2018" class="csl-entry">
Dennett, Adam. 2018. <span>“Modelling Population Flows Using Spatial
Interaction Models.”</span> <em>Australian Population Studies</em> 2
(2): 33–58. <a href="https://doi.org/10.37970/aps.v2i2.38" class="external-link">https://doi.org/10.37970/aps.v2i2.38</a>.
</div>
<div id="ref-lenormand_systematic_2016" class="csl-entry">
Lenormand, Maxime, Aleix Bassolas, and José J. Ramasco. 2016.
<span>“Systematic Comparison of Trip Distribution Laws and
Models.”</span> <em>Journal of Transport Geography</em> 51 (February):
158–69. <a href="https://doi.org/10.1016/j.jtrangeo.2015.12.008" class="external-link">https://doi.org/10.1016/j.jtrangeo.2015.12.008</a>.
</div>
<div id="ref-simini_universal_2012" class="csl-entry">
Simini, Filippo, Marta C González, Amos Maritan, and Albert-László
Barabási. 2012. <span>“A Universal Model for Mobility and Migration
Patterns.”</span> <em>Nature</em>, February, 812. <a href="https://doi.org/10.1038/nature10856" class="external-link">https://doi.org/10.1038/nature10856</a>.
</div>
<div id="ref-wilson_family_1971" class="csl-entry">
Wilson, AG. 1971. <span>“A Family of Spatial Interaction Models, and
Associated Developments.”</span> <em>Environment and Planning</em> 3
(January): 132.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Lovelace, Jakub Nowosad.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
